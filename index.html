<html>
<head>
<script src="https://storage.googleapis.com/prshim/v1/payment-shim.js"></script>
</head>
<body>


<script>

function onBuyClicked() {
  if (!window.PaymentRequest) {
    // PaymentRequest API is not available. Forwarding to
    // legacy form based experience.
    alert("browser not Supported");
    return;
  }

  // Supported payment methods
  var supportedInstruments = [{
    supportedMethods: [
      'visa', 'mastercard', 'amex'
    ]
  }];

  // Checkout details
  var details = {
    displayItems: [{
      label: 'TEST Item 1',
      amount: { currency: 'USD', value: '65.00' }
    }, {
      label: 'Friends and family discount',
      amount: { currency: 'USD', value: '-10.00' }
    }],
    total: {
      label: 'Total',
      amount: { currency: 'USD', value : '55.00' }
    }
  };

  // 1. Create a `PaymentRequest` instance
  var request = new PaymentRequest(supportedInstruments, details);

  // 2. Show the native UI with `.show()`
  request.show()
  // 3. Process the payment
  .then(result => {
    var data = {};
    data.methodName = result.methodName;
    data.details    = result.details;

    // POST the payment information to the server
    return fetch('/pay', {
      method: 'POST',
      credentials: 'include',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(data)
    }).then(response => {
      // Examine server response
      if (response.status === 200) {
        // Payment successful
        return result.complete('success');
      } else {
        // Payment failure
        return result.complete('fail');
      }
    }).catch(() => {
      return result.complete('fail');
    });
  });
}

</script>
<input type="button" onclick="onBuyClicked()" value="Demo"></input>
</body>
</html>
